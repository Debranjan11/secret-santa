<!DOCTYPE html>
<html>
<head>
  <title>Secret Santa ğŸ…</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- ğŸ„ STAGE 1: HERO / MOOD -->
  <section class="hero">
    <h1>ğŸ„ Spread the Joy of Giving</h1>
    <p>Create magical Secret Santa moments for friends, family, and teams.</p>
    <span class="scroll-hint">â†“ Scroll to begin â†“</span>
  </section>
  
  <!-- ğŸ STAGE 2: SECRET SANTA TOOL -->
  <section class="tool">
    <div class="container">
      <h1>ğŸ„ Secret Santa Generator</h1>

      <div class="subtitle">
        Securely assign gift partners and notify by email ğŸ
      </div>

      <!-- INLINE MESSAGE -->
      <div id="message" class="message hidden"></div>

      <!-- PARTICIPANTS -->
      <div id="list"></div>

      <!-- ADMIN KEY -->
      <div id="admin-box" class="admin-box hidden">
        <input type="password" id="admin-key" placeholder="Admin key" />
      </div>

      <!-- ACTION BUTTONS -->
      <div class="actions">
        <button class="add-btn" onclick="add()">â• Add Person</button>
        <button class="generate-btn" onclick="generate()">ğŸ Generate</button>
      </div>

      <div class="footer">
        Admin-protected â€¢ Emails sent privately ğŸ”’
      </div>
    </div>
  </section>

  <!-- ğŸ§  STAGE 3: HOW IT WORKS -->
  <section class="how-it-works">
    <h2>âœ¨ How It Works</h2>
    <div class="steps">
      <div>ğŸ… Add participants</div>
      <div>ğŸ”’ Generate securely</div>
      <div>ğŸ“§ Everyone gets a private email</div>
    </div>
  </section>

  <!-- â„ï¸ STAGE 4: CHRISTMAS VIBE -->
  <section class="vibe">
    <p>ğŸ„ Made for cozy December moments.</p>
  </section>

  <!-- ğŸ§¾ FOOTER -->
  <footer class="site-footer">
    <p>Made with â¤ï¸ for the holidays</p>
  </footer>

<script>
function showMessage(text, type) {
  const msg = document.getElementById("message");
  msg.innerText = text;
  msg.className = `message ${type}`;
}

function add() {
  const div = document.createElement("div");
  div.className = "participant";
  div.innerHTML = `
    <input placeholder="Name">
    <input placeholder="Email">
  `;
  document.getElementById("list").appendChild(div);
}

async function generate() {
  const adminBox = document.getElementById("admin-box");
  const adminInput = document.getElementById("admin-key");

  // First click â†’ show admin input
  if (adminBox.classList.contains("hidden")) {
    adminBox.classList.remove("hidden");
    adminInput.focus();
    showMessage("Enter admin key to generate assignments.", "error");
    return;
  }

  const adminKey = adminInput.value.trim();
  if (!adminKey) {
    showMessage("Admin key is required.", "error");
    return;
  }

  const rows = document.querySelectorAll(".participant");
  const participants = [];

  rows.forEach(r => {
    const inputs = r.querySelectorAll("input");
    participants.push({
      name: inputs[0].value.trim(),
      email: inputs[1].value.trim()
    });
  });

  if (participants.length < 2) {
    showMessage("Please add at least 2 participants.", "error");
    return;
  }

  const res = await fetch("/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      participants,
      admin_key: adminKey
    })
  });

  const data = await res.json();

  if (res.ok) {
    showMessage(data.message, "success");
    adminInput.value = "";
    adminBox.classList.add("hidden");
  } else {
    showMessage(data.error || "Unauthorized", "error");
  }
}
</script>

</body>

</html>
