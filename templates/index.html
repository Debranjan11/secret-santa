<!DOCTYPE html>
<html>
<head>
  <title>Secret Santa ğŸ…</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
  <h1>ğŸ„ Secret Santa Generator</h1>

  <div class="subtitle">
    Securely assign gift partners and notify by email ğŸ
  </div>

  <!-- ğŸ”” INLINE MESSAGE AREA (REQUIRED) -->
  <div id="message" class="message hidden"></div>

  <div id="list"></div>

  <!-- ğŸ” ADMIN INPUT -->
  <div id="admin-box" class="admin-box hidden">
    <input type="password" id="admin-key" placeholder="Admin key" />
  </div>

  <div class="actions">
    <button class="add-btn" onclick="add()">â• Add Person</button>
    <button class="generate-btn" onclick="generate()">ğŸ Generate</button>
  </div>

  <div class="footer">
    Admin-protected â€¢ Emails sent privately ğŸ”’
  </div>
</div>

<script>
function showMessage(text, type) {
  const msg = document.getElementById("message");
  msg.innerText = text;
  msg.className = `message ${type}`;
}

function add() {
  const div = document.createElement("div");
  div.className = "participant";
  div.innerHTML = `
    <input placeholder="Name">
    <input placeholder="Email">
  `;
  document.getElementById("list").appendChild(div);
}

async function generate() {
  const adminBox = document.getElementById("admin-box");
  const adminInput = document.getElementById("admin-key");

  // First click â†’ show admin input
  if (adminBox.classList.contains("hidden")) {
    adminBox.classList.remove("hidden");
    adminInput.focus();
    showMessage("Enter admin key to generate assignments.", "error");
    return;
  }

  const adminKey = adminInput.value.trim();
  if (!adminKey) {
    showMessage("Admin key is required.", "error");
    return;
  }

  const rows = document.querySelectorAll(".participant");
  const participants = [];

  rows.forEach(r => {
    const inputs = r.querySelectorAll("input");
    participants.push({
      name: inputs[0].value.trim(),
      email: inputs[1].value.trim()
    });
  });

  if (participants.length < 2) {
    showMessage("Please add at least 2 participants.", "error");
    return;
  }

  const res = await fetch("/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      participants,
      admin_key: adminKey
    })
  });

  const data = await res.json();

  if (res.ok) {
    showMessage(data.message, "success");
    adminInput.value = "";
    adminBox.classList.add("hidden");
  } else {
    showMessage(data.error || "Unauthorized", "error");
  }
}
</script>

</body>

</html>
