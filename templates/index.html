<!DOCTYPE html>
<html>
<head>
  <title>Secret Santa ğŸ…</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- ğŸ„ STAGE 1: HERO / MOOD -->
  <section class="hero">
    <h1>ğŸ„ Spread the Joy of Giving</h1>
    <p>Create magical Secret Santa moments for friends, family, and teams.</p>
    <span class="scroll-hint">â†“ Scroll to begin â†“</span>
  </section>

  <div class="divider">â„ï¸ â„ï¸ â„ï¸</div>

  <!-- ğŸ STAGE 2: SECRET SANTA TOOL -->
  <section class="tool">
    <div class="container">
      <h1>ğŸ„ Secret Santa Generator</h1>

      <div class="subtitle">
        Securely assign gift partners and notify by email ğŸ
      </div>

      <!-- INLINE MESSAGE -->
      <div id="message" class="message hidden"></div>

      <!-- PARTICIPANTS -->
      <div id="list"></div>

      <!-- ADMIN KEY -->
      <div id="admin-box" class="admin-box hidden">
        <input type="password" id="admin-key" placeholder="Admin key" />
      </div>

      <!-- ACTION BUTTONS -->
      <div class="actions">
        <button class="add-btn" onclick="add()">â• Add Person</button>
        <button class="generate-btn" onclick="generate()">ğŸ Generate</button>
        <p class="privacy-note">
  ğŸ”’ No data is stored. Emails are sent once and discarded.
</p>

      </div>

      <div class="footer">
        Admin-protected â€¢ Emails sent privately ğŸ”’
      </div>
    </div>
  </section>

<div class="divider">â„ï¸ â„ï¸ â„ï¸</div>

  <!-- ğŸ§  STAGE 3: HOW IT WORKS -->
  <section class="how-it-works">
    <h2>âœ¨ How It Works</h2>
    <div class="steps">
  <div class="step-card">
    ğŸ…
    <h3>Add Participants</h3>
    <p>Enter names and emails of everyone joining the exchange.</p>
  </div>

  <div class="step-card">
    ğŸ
    <h3>Generate Securely</h3>
    <p>Assignments are created fairly and privately.</p>
  </div>

  <div class="step-card">
    âœ‰ï¸
    <h3>Private Emails</h3>
    <p>Each participant receives only their own Secret Santa.</p>
  </div>
 </div>

  </section>

  <div class="divider">â„ï¸ â„ï¸ â„ï¸</div>

  <!-- â„ï¸ STAGE 4: CHRISTMAS VIBE -->
   <!-- ğŸ§¾ FOOTER -->
  <footer class="footer">
    ğŸ„ Made with warmth, joy, and a little holiday magic  
  <br />
  <small>Secret Santa â€¢ December Edition</small>
</footer>

  <div class="snow-container">
  <span class="snow">â„</span>
  <span class="snow">â„</span>
  <span class="snow">â„</span>
  <span class="snow">â„</span>
  <span class="snow">â„</span>
  <span class="snow">â„</span>
  <span class="snow">â„</span>
</div>

<script>
function showMessage(text, type) {
  const msg = document.getElementById("message");
  msg.innerText = text;
  msg.className = `message ${type}`;
}

function add() {
  const div = document.createElement("div");
  div.className = "participant";
  div.innerHTML = `
    <input placeholder="Name">
    <input placeholder="Email">
  `;
  document.getElementById("list").appendChild(div);
}

async function generate() {
  const adminBox = document.getElementById("admin-box");
  const adminInput = document.getElementById("admin-key");

  // First click â†’ show admin input
  if (adminBox.classList.contains("hidden")) {
    adminBox.classList.remove("hidden");
    adminInput.focus();
    showMessage("Enter admin key to generate assignments.", "error");
    return;
  }

  const adminKey = adminInput.value.trim();
  if (!adminKey) {
    showMessage("Admin key is required.", "error");
    return;
  }
  const generateBtn = document.querySelector(".generate-btn");
  generateBtn.disabled = true;
  generateBtn.innerText = "Sendingâ€¦";

  const rows = document.querySelectorAll(".participant");
  const participants = [];

  rows.forEach(r => {
    const inputs = r.querySelectorAll("input");
    participants.push({
      name: inputs[0].value.trim(),
      email: inputs[1].value.trim()
    });
  });

  if (participants.length < 2) {
    showMessage("Please add at least 2 participants.", "error");
    return;
  }

  const res = await fetch("/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      participants,
      admin_key: adminKey
    })
  });

  const data = await res.json();

  if (res.ok) {
    showMessage(data.message, "success");
    adminInput.value = "";
    adminBox.classList.add("hidden");
  } else {
    showMessage(data.error || "Unauthorized", "error");
  }
  generateBtn.disabled = false;
  generateBtn.innerText = "ğŸ Generate";

}
</script>

</body>

</html>
